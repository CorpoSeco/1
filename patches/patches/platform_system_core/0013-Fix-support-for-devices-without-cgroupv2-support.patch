From 506f24d5d48c7fd49821b35ee475f4ded81714db Mon Sep 17 00:00:00 2001
From: Pierre-Hugues Husson <phh@phh.me>
Date: Wed, 26 Oct 2022 17:59:11 -0400
Subject: [PATCH 13/15] Fix support for devices without cgroupv2 support

This is technically a revert of 1bd1746447.
The warning inside the commit doesn't really apply to us, because the
devices without cgroupv2 simply won't freeze processes at all
(which is in itself an issue, but a different one)
---
 init/service.cpp | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/init/service.cpp b/init/service.cpp
index bd704cf8e..188b042d9 100644
--- a/init/service.cpp
+++ b/init/service.cpp
@@ -660,11 +660,15 @@ Result<void> Service::Start() {
                       limit_percent_ != -1 || !limit_propert>
      errno = -createProcessGroup(proc_attr_.uid, pid_, use_m>
      if (errno != 0) {
+         PLOG(ERROR) << "createProcessGroup(" << proc_attr_.>
+
+#if 0
         if (char byte = 0; write((*pipefd)[1], &byte, 1) < 0>
             return ErrnoError() << "sending notification fai>
         }
         return Error() << "createProcessGroup(" << proc_attr>
                        << ") failed for service '" << name_ >
+#endif
     }

         if (use_memcg) {
--
2.34.1
